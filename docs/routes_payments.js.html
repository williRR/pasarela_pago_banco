<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: routes/payments.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: routes/payments.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import express from "express";
import { processPayment } from "../services/bankService.js";

/**
 * Módulo de ruteo para la pasarela de pagos.
 * @module routes/payment
 * @requires express
 * @requires ../services/bankService
 */
const router = express.Router();

// --- Documentación de Tipos de Datos (Schemas) ---

/**
 * @typedef {object} ChargeRequest
 * @property {string} merchantId - ID único del comercio que realiza la transacción.
 * @property {number} amount - Monto de la transacción (ej. 100.00).
 * @property {string} cardNumber - Número de tarjeta de crédito (sin espacios).
 * @property {string} expDate - Fecha de expiración de la tarjeta (MM/AA).
 * @property {string} cvv - Código de seguridad de tres o cuatro dígitos.
 */

/**
 * @typedef {object} ChargeSuccessResponse
 * @property {string} status - El estado de la transacción. Siempre "success".
 * @property {number} transactionId - El ID de la transacción generado por la pasarela/banco.
 * @property {string} message - Mensaje descriptivo del resultado.
 */

/**
 * @typedef {object} ChargeErrorResponse
 * @property {string} status - El estado de la transacción. Siempre "failed".
 * @property {string} message - Mensaje de error detallado del banco.
 */

// --- Documentación del Endpoint ---

/**
 * Endpoint para procesar pagos de comercio electrónico.
 *
 * Este endpoint recibe la información de la tarjeta y el monto para
 * procesar el cobro a través del servicio bancario (`processPayment`).
 *
 * @name POST /charge
 * @function
 * @memberof module:routes/payment
 * @param {object} req - Objeto de solicitud de Express.
 * @param {ChargeRequest} req.body - Datos requeridos para el pago.
 * @param {object} res - Objeto de respuesta de Express.
 * @returns {ChargeSuccessResponse | ChargeErrorResponse} Retorna el resultado de la transacción o un error.
 * @returns {object} 400 - Error si faltan campos requeridos en el cuerpo de la solicitud.
 * @returns {object} 500 - Error interno si la pasarela falla.
 */
router.post("/charge", async (req, res) => {
// ... el resto de tu lógica de Express (sin cambios)
  try {
    const { merchantId, amount, cardNumber, expDate, cvv } = req.body;

    if (!merchantId || !amount || !cardNumber || !expDate || !cvv) {
      return res.status(400).json({ error: "Faltan datos requeridos" });
    }

    // Lógica para procesar el pago con tu banco
    const result = await processPayment({ merchantId, amount, cardNumber, expDate, cvv });

    if (result.success) {
      return res.json({
        status: "success",
        transactionId: result.transactionId,
        message: "Pago procesado correctamente"
      });
    } else {
      return res.status(400).json({
        status: "failed",
        message: result.message
      });
    }

  } catch (error) {
    console.error("Error en pasarela:", error);
    res.status(500).json({ error: "Error interno en pasarela" });
  }
});

export default router;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-config.html">config</a></li><li><a href="module-routes_payment.html">routes/payment</a></li></ul><h3>Global</h3><ul><li><a href="global.html#processPayment">processPayment</a></li><li><a href="global.html#registerInitialTransaction">registerInitialTransaction</a></li><li><a href="global.html#updateTransactionStatus">updateTransactionStatus</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Oct 06 2025 15:56:12 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
